# PROJECT_MEMORY.md 精簡計劃

## 現況分析

**當前狀態**：
- 行數：2,633 行
- 檔案大小：76KB
- 主要章節：14 個
- 問題：檔案過大，AI 助手難以完整讀取

**章節分布**：
1. ⚠️ 常見錯誤提醒（AI 助手必讀）
2. 📋 相關文件索引
3. 🚀 Phase 3.2: Tiny 版本開發經驗
4. 💡 經驗教訓（通用）
5. 🚀 Phase 3.1 經驗教訓
6. 📝 開發流程提醒
7. 🌐 Phase 3.2 Edge UI 移植經驗教訓
8. 🔧 Phase 3.2 固件更新功能經驗教訓
9. 🗄️ Phase 3.2: 本地指令歷史與快取實作
10. 🌐 Phase 3.3 統一整合與雲端分離經驗教訓
11. 🔍 Phase 3.2: Code Review 與 CodeQL 安全修復
12. 🎨 TUI + LLM 自然語言控制整合
13. 🧪 Phase 6: CLI 批次操作測試與驗證
14. 🔧 倉庫代碼品質優化

---

## 精簡方案

### 方案 A：分層架構（推薦）⭐

**策略**：保留核心經驗在主檔案，詳細內容移至專題文件

**結構**：
```
docs/
├── PROJECT_MEMORY.md (核心，< 500 行)
│   ├── ⚠️ 常見錯誤提醒（必讀）
│   ├── 📋 文件索引
│   ├── 🎯 關鍵經驗精華（10-15 條）
│   └── 📚 詳細經驗索引（指向專題文件）
├── memory/
│   ├── phase3_lessons.md (Phase 3 所有經驗)
│   ├── cli_batch_lessons.md (CLI 批次操作)
│   ├── tui_llm_lessons.md (TUI + LLM)
│   ├── security_lessons.md (安全相關)
│   └── code_quality_lessons.md (代碼品質)
```

**優點**：
- ✅ 主檔案精簡易讀（< 500 行）
- ✅ 保留所有資訊，不丟失細節
- ✅ 分類清晰，易於查找
- ✅ AI 助手可根據需要讀取特定專題
- ✅ 便於持續更新和維護

**缺點**：
- ❌ 需要建立多個新檔案
- ❌ 初次設置較費時

**實作工作量**：中等（約 30-45 分鐘）

---

### 方案 B：時間軸濃縮

**策略**：按時間軸壓縮舊經驗，保留近期詳細內容

**結構**：
```
docs/PROJECT_MEMORY.md
├── ⚠️ 常見錯誤提醒
├── 📋 文件索引
├── 🎯 近期經驗（詳細，最近 1-2 個月）
│   ├── Phase 6: CLI 批次操作（2025-12-17）
│   ├── 倉庫代碼品質優化（2025-12-17）
│   └── TUI + LLM 整合（2025-12-11）
├── 📦 歷史經驗（濃縮，僅保留關鍵要點）
│   ├── Phase 3.3（2025-12-10）- 3-5 條關鍵經驗
│   ├── Phase 3.2（2025-12-10）- 3-5 條關鍵經驗
│   └── Phase 3.1（更早）- 3-5 條關鍵經驗
└── 📚 完整歷史經驗（移至 docs/archive/）
```

**優點**：
- ✅ 單一檔案，查找方便
- ✅ 近期經驗詳細，歷史濃縮
- ✅ 實作較簡單

**缺點**：
- ❌ 歷史細節丟失（移至 archive）
- ❌ 檔案仍可能超過 1000 行
- ❌ 難以擴展

**實作工作量**：較低（約 15-20 分鐘）

---

### 方案 C：主題式索引

**策略**：按主題重組，每個主題保留最重要的 3-5 條經驗

**結構**：
```
docs/PROJECT_MEMORY.md (< 800 行)
├── ⚠️ 常見錯誤提醒
├── 📋 文件索引
├── 🎯 核心主題經驗
│   ├── 1. 測試與品質保證（5 條）
│   ├── 2. 安全性與 CodeQL（5 條）
│   ├── 3. 前端整合（5 條）
│   ├── 4. LLM 整合（5 條）
│   ├── 5. 批次操作與自動化（5 條）
│   ├── 6. 代碼品質與 Linting（5 條）
│   └── 7. 架構設計（5 條）
└── 📚 詳細主題文件（指向 docs/topics/）
```

**優點**：
- ✅ 主題分明，易於查找
- ✅ 避免重複相似經驗
- ✅ 適合跨專案參考

**缺點**：
- ❌ 重組工作量大
- ❌ 可能丟失時間脈絡
- ❌ 難以判斷哪些經驗最重要

**實作工作量**：高（約 60-90 分鐘）

---

## 比較表

| 方案 | 主檔案大小 | 資訊保留 | 易維護性 | 易查找性 | 實作工作量 | 推薦度 |
|------|-----------|---------|---------|---------|-----------|--------|
| A. 分層架構 | ~500 行 | 100% | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 中等 | ⭐⭐⭐⭐⭐ |
| B. 時間軸濃縮 | ~1000 行 | 80% | ⭐⭐⭐ | ⭐⭐⭐ | 低 | ⭐⭐⭐ |
| C. 主題式索引 | ~800 行 | 70% | ⭐⭐ | ⭐⭐⭐⭐⭐ | 高 | ⭐⭐ |

---

## 推薦方案：方案 A（分層架構）

### 理由

1. **最佳平衡**：檔案大小、資訊保留、可維護性的最佳平衡
2. **可擴展**：未來新增經驗只需建立新專題文件
3. **不丟失資訊**：所有細節都保留，只是重新組織
4. **AI 友善**：主檔案小，AI 可快速掌握全局；需要時可讀取特定專題
5. **符合目前架構**：已有 `docs/development/` 等目錄，新增 `docs/memory/` 很自然

### 實作步驟

1. **建立 docs/memory/ 目錄**
2. **抽取並建立專題文件**：
   - `phase3_lessons.md`：Phase 3.1, 3.2, 3.3 所有經驗
   - `cli_batch_lessons.md`：Phase 6 CLI 批次操作經驗
   - `tui_llm_lessons.md`：TUI + LLM 整合經驗
   - `security_lessons.md`：CodeQL、安全修復經驗
   - `code_quality_lessons.md`：Linting、代碼品質經驗
3. **精簡主檔案**：
   - 保留常見錯誤提醒（必讀）
   - 保留文件索引
   - 新增「關鍵經驗精華」（10-15 條最重要的）
   - 新增「詳細經驗索引」（指向各專題文件）
4. **更新交叉引用**：確保各文件間的連結正確

### 預期成果

**主檔案 (PROJECT_MEMORY.md)**：
- 大小：~450 行（< 20KB）
- 內容：核心提醒 + 精華經驗 + 索引

**專題文件 (docs/memory/\*.md)**：
- 5 個檔案，每個 300-600 行
- 總資訊量不變，只是重新組織

**整體效益**：
- ✅ AI 助手可快速讀取主檔案
- ✅ 需要時可深入讀取特定專題
- ✅ 便於未來維護和擴展
- ✅ 不丟失任何資訊

---

## 次選方案：方案 B（快速實作）

如果時間緊迫，可先採用方案 B：

1. 保留近 2 個月的詳細經驗（Phase 6, TUI+LLM）
2. 將 Phase 3.x 經驗濃縮為關鍵要點（每個 Phase 3-5 條）
3. 將完整 Phase 3 內容移至 `docs/archive/PROJECT_MEMORY_PHASE3.md`

預期主檔案：~900 行（可接受但仍偏大）

---

**建議**：採用方案 A，投資一次時間建立良好架構，長期受益。
