{% extends "edge/base.html" %}

{% block title %}чФицИ╢шинхоЪ{% endblock %}

{% block content %}
<div class="page-header">
    <h1>тЪЩя╕П чФицИ╢шинхоЪ</h1>
    <p class="subtitle">шк┐цХ┤цЬмхЬ░хБПхе╜шинхоЪ</p>
</div>

<div class="settings-container">
    <!-- UI шинхоЪ -->
    <div class="settings-section">
        <h2>ЁЯОи ф╗ЛщЭвшинхоЪ</h2>
        
        <div class="setting-item">
            <div class="setting-info">
                <label>цЩВщЦУхЦоф╜Н</label>
                <p class="setting-desc">щБ╕цУЗщА▓щЪОцМЗф╗дч╖иш╝пхЩиф╕нчЪДцЩВщЦУщбпчд║хЦоф╜Н</p>
            </div>
            <div class="setting-control">
                <select id="duration-unit" onchange="saveSetting('duration_unit', this.value)">
                    <option value="s">чзТ (s)</option>
                    <option value="ms">цплчзТ (ms)</option>
                </select>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <label>ф╕╗щбМ</label>
                <p class="setting-desc">щБ╕цУЗф╗ЛщЭвф╕╗щбМ</p>
            </div>
            <div class="setting-control">
                <select id="theme" onchange="saveSetting('theme', this.value)">
                    <option value="light">ц╖║шЙ▓</option>
                    <option value="dark">ц╖▒шЙ▓</option>
                    <option value="auto">шЗкхЛХ</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- LLM хБПхе╜ -->
    <div class="settings-section">
        <h2>ЁЯза LLM хБПхе╜</h2>
        
        <div class="setting-item">
            <div class="setting-info">
                <label>щаРшинцПРф╛ЫхХЖ</label>
                <p class="setting-desc">щБ╕цУЗщаРшинчЪД LLM цПРф╛ЫхХЖ</p>
            </div>
            <div class="setting-control">
                <select id="llm-provider" onchange="saveSetting('llm_provider', this.value)">
                    <option value="">цЬкшинхоЪ</option>
                    <option value="ollama">Ollama</option>
                    <option value="lmstudio">LM Studio</option>
                </select>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <label>щаРшинцибхЮЛ</label>
                <p class="setting-desc">ш╝╕хЕещаРшинф╜┐чФичЪДцибхЮЛхРНчи▒</p>
            </div>
            <div class="setting-control">
                <input type="text" id="llm-model" placeholder="ф╛Ля╝Ъllama2:latest" 
                       onchange="saveSetting('llm_model', this.value)">
            </div>
        </div>
    </div>
    
    <!-- щЧЬцЦ╝ -->
    <div class="settings-section">
        <h2>тД╣я╕П щЧЬцЦ╝</h2>
        
        <div class="about-info">
            <p><strong>Robot Command Console - Edge App</strong></p>
            <p>чЙИцЬмя╝ЪPhase 3.2</p>
            <p>цЬмхЬ░ WebUI чз╗цдНчЙИцЬм</p>
        </div>
        
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="resetSettings()">
                ЁЯФД щЗНшинцЙАцЬЙшинхоЪ
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// щаБщЭвш╝ЙхЕецЩВш╝ЙхЕешинхоЪ
document.addEventListener('DOMContentLoaded', loadSettings);

// ш╝ЙхЕешинхоЪ
async function loadSettings() {
    try {
        const res = await fetch('/api/edge/settings');
        const data = await res.json();
        
        if (data.settings) {
            document.getElementById('duration-unit').value = data.settings.duration_unit || 's';
            document.getElementById('theme').value = data.settings.theme || 'light';
            document.getElementById('llm-provider').value = data.settings.llm_provider || '';
            document.getElementById('llm-model').value = data.settings.llm_model || '';
        }
    } catch (error) {
        console.error('Failed to load settings:', error);
    }
}

// хД▓хнШшинхоЪ
async function saveSetting(key, value) {
    try {
        const settings = {};
        settings[key] = value;
        
        const res = await fetch('/api/edge/settings', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        
        const data = await res.json();
        if (data.success) {
            showToast('шинхоЪх╖▓хД▓хнШ');
        }
    } catch (error) {
        console.error('Failed to save setting:', error);
        showToast('хД▓хнШхд▒цХЧ', 'error');
    }
}

// щЗНшиншинхоЪ
async function resetSettings() {
    if (!confirm('чв║хоЪшжБщЗНшинцЙАцЬЙшинхоЪхЧОя╝Я')) {
        return;
    }
    
    try {
        const res = await fetch('/api/edge/settings', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                duration_unit: 's',
                theme: 'light',
                llm_provider: null,
                llm_model: null
            })
        });
        
        const data = await res.json();
        if (data.success) {
            loadSettings();
            showToast('шинхоЪх╖▓щЗНшин');
        }
    } catch (error) {
        console.error('Failed to reset settings:', error);
        showToast('щЗНшинхд▒цХЧ', 'error');
    }
}

// щбпчд║цПРчд║шиКцБп
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>
{% endblock %}
